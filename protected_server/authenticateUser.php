<?php
require_once 'auth.php';
require_once 'database.php';
global $connection;

	// if (!empty($_SERVER['HTTPS']) && ('on' == $_SERVER['HTTPS'])) {
	// 	$uri = 'https://';
	// } else {
	// 	$uri = 'http://';
	// }
	// $uri .= $_SERVER['HTTP_HOST'];
    // header('Location: '.$uri.'/dashboard/');
    
        // If post, check user
    if (!empty($_POST['userlogin']) && !empty($_POST['pass'])) {
        // Verify user and password
        echo "line 16\n";
        if (isValidUser($_POST['userlogin'], $_POST['pass'])) {
            // Log in
            echo "line 19\n";
            $_SESSION['userlogin'] = $_POST['userlogin'];
            header('Location: index.php');
            exit();
        }
        else
        {
            $_SESSION['userlogin'] = FALSE;
        }
    }

function isValidUser($user, $pass)
{
    
    global $connection;
    echo $pass . "\n";
    if (!$connection){
        echo "yo you hecked";
    }
    //  Implement validation: db, array, whatever...
    if (!$query = $connection->query("SELECT * FROM users WHERE user_login = '".$user."'")){
    // echo mysqli_error($connection);
        echo $connection->lastErrorMsg();
        echo "\nThere was an error with the database.";
    }
    echo $pass . "\n";
    $userToCheck = $query->fetchArray();
    $passToCheck = $userToCheck['user_password'];
    echo $passToCheck . "\n";

    if ($passToCheck == $pass){
        return True;
    }
    if ($user === 'admin' && $pass === 'admin') {
        return TRUE;
    }
    return FALSE;
}
	echo "YO"?>