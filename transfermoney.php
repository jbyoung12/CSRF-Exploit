<?php
require_once('database.php');

//post with money you want, and the destination address
//into database to using the user's session id to get the source address
//and transfer that money
if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    if(!empty($_POST["destination_address"]) && !empty($_POST["amount"])) {
        // TODO get sessionid and user from that id
        if (!$query = $connection->query("SELECT * FROM users WHERE user_login = 'admin'")){
            echo mysqli_error($connection);
        }
        $user = $query->fetch_object();
        $source = $user->bank_address;
        $dest = $_POST["destination_address"];

        // could check for valid address
        if (!$query = $connection->query("SELECT balance FROM users WHERE bank_address = '".$dest."'")){
            echo mysqli_error($connection);
        }
        // could check amounts are valid
        $destUser = $query->fetch_object();
        $destBalance = $destUser->balance + $_POST["amount"];
        $sourceBalance = $user->balance - $_POST["amount"];

        if (!$connection->query("UPDATE users SET balance=".$destBalance." WHERE bank_address='".$dest."';")) {
            echo mysqli_error($connection);
        }
        if (!$connection->query("UPDATE users SET balance=".$sourceBalance." WHERE bank_address='".$source."';")) {
            echo mysqli_error($connection);
        }

        echo money_format('$%i', $_POST["amount"]/100) . " sent from address " . $source . " to address " . $dest;

    }
}
?>